version: '3.8'

# Option A: Unified Full-Stack Service (Single Container)
# Use this for Render deployment
services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:80"
    volumes:
      - ./data:/app/data
    environment:
      - JWT_SECRET=${JWT_SECRET:-your-super-secret-jwt-key-change-in-production}
      - DATABASE_PATH=/app/data/events.db
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80/health"]
      interval: 30s
      timeout: 10s
      retries: 3

# Option B: Separate Services (Development)
# Uncomment this section and comment out Option A for local development
# services:
#   backend:
#     build:
#       context: .
#       dockerfile: backend.Dockerfile
#     ports:
#       - "8080:8080"
#     environment:
#       - DATABASE_HOST=/tmp/events.db
#       - JWT_SECRET=${JWT_SECRET:-your-super-secret-jwt-key-change-in-production}
#     healthcheck:
#       test: ["CMD", "wget", "-q", "--spider", "http://localhost:8080/health"]
#       interval: 30s
#       timeout: 10s
#       retries: 3
#
#   frontend:
#     build:
#       context: ./frontend
#       dockerfile: Dockerfile
#     ports:
#       - "3000:80"
#     depends_on:
#       - backend
#     environment:
#       - VITE_API_URL=http://localhost:8080/api/v1
#       - VITE_WS_URL=ws://localhost:8080/ws
